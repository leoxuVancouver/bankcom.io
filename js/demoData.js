
var levelData = [{id:"1",name:"adidas/阿迪达斯",pid:""},
{id:"2",name:"Aokang/奥康",pid:""},
{id:"3",name:"Belle/百丽",pid:""},
{id:"4",name:"Camel/骆驼",pid:""},
{id:"5",name:"Gucci/古奇",pid:""},
{id:"6",name:"PlayBoy/花花公子",pid:""},
{id:"7",name:"St&Sat/星期六",pid:""},
{id:"8",name:"Tata/他她",pid:""},
{id:"9",name:"Teenmix/天美意",pid:""},

{id:"11",name:"服饰",pid:""},
{id:"12",name:"鞋类",pid:""},
{id:"13",name:"箱包",pid:""},
{id:"14",name:"茶叶茶具",pid:""},
{id:"15",name:"化学",pid:""},
{id:"16",name:"图书母婴",pid:""},
{id:"17",name:"宠物用品",pid:""},

{id:"l1",name:"女鞋",pid:"12"},
{id:"l1_1",name:"高跟鞋",pid:"l1"},
{id:"l1_2",name:"短靴",pid:"l1"},
{id:"l1_3",name:"长靴",pid:"l1"},
{id:"l1_4",name:"马丁靴",pid:"l1"},
{id:"l1_5",name:"雪地靴",pid:"l1"},
{id:"l1_6",name:"流苏靴",pid:"l1"},
{id:"l1_7",name:"高帮鞋",pid:"l1"},
{id:"l1_8",name:"平底鞋",pid:"l1"},
{id:"l1_9",name:"坡跟单鞋 ",pid:"l1"},
{id:"l1_10",name:"高跟鞋",pid:"l1"},
{id:"l1_11",name:"浅口单鞋",pid:"l1"},
{id:"l1_12",name:"鱼嘴单鞋",pid:"l1"},
{id:"l1_13",name:"尖头单鞋",pid:"l1"},
{id:"l1_14",name:"豆豆鞋",pid:"l1"},

{id:"l2",name:"男鞋",pid:"12"},
{id:"l2_1",name:"休闲鞋",pid:"l2"},
{id:"l2_2",name:"皮鞋",pid:"l2"},
{id:"l2_3",name:"布洛克",pid:"l2"},
{id:"l2_4",name:"登山鞋",pid:"l2"},
{id:"l2_5",name:"帆布鞋",pid:"l2"},
{id:"l2_6",name:"豆豆鞋",pid:"l2"},
{id:"l2_7",name:"板鞋",pid:"l2"},
{id:"l2_8",name:"帆船鞋",pid:"l2"},
{id:"l2_9",name:"布鞋",pid:"l2"},
{id:"l2_10",name:"网面鞋",pid:"l2"},
{id:"l2_11",name:"伐木鞋",pid:"l2"},
{id:"l2_12",name:"内增高",pid:"l2"},

{id:"l3",name:"男装",pid:"11"},
{id:"l3_1",name:"T恤",pid:"l3"},
{id:"l3_2",name:"POLO衫",pid:"l3"},
{id:"l3_3",name:"短裤",pid:"l3"},
{id:"l3_4",name:"衬衫",pid:"l3"},
{id:"l3_5",name:"休闲裤",pid:"l3"},
{id:"l3_6",name:"小脚裤",pid:"l3"},
{id:"l3_7",name:"牛仔裤",pid:"l3"},
{id:"l3_8",name:"夹克",pid:"l3"},
{id:"l3_9",name:"风衣",pid:"l3"},
{id:"l3_10",name:"针织衫",pid:"l3"},
{id:"l3_11",name:"卫衣",pid:"l3"},
{id:"l3_12",name:"西服",pid:"l3"},

{id:"l4",name:"女装",pid:"11"},
{id:"l4_1",name:"连衣裙",pid:"l4"},
{id:"l4_2",name:"衬衫",pid:"l4"},
{id:"l4_3",name:"针织衫",pid:"l4"},
{id:"l4_4",name:"蕾丝衫",pid:"l4"},
{id:"l4_5",name:"雪纺衫",pid:"l4"},
{id:"l4_6",name:"风衣",pid:"l4"},
{id:"l4_7",name:"T恤",pid:"l4"},
{id:"l4_8",name:"半身裙",pid:"l4"},
{id:"l4_9",name:"卫衣",pid:"l4"},
{id:"l4_10",name:"毛衣",pid:"l4"},
{id:"l4_11",name:"皮衣",pid:"l4"},
{id:"l4_12",name:"牛仔裤",pid:"l4"},
{id:"l4_13",name:"连衣裙",pid:"l4"},
{id:"l4_14",name:"西装",pid:"l4"},

{id:"l5",name:"户外运动",pid:"11"},
{id:"l5_1",name:"跑步鞋",pid:"l5"},
{id:"l5_2",name:"板鞋",pid:"l5"},
{id:"l5_3",name:"篮球鞋",pid:"l5"},
{id:"l5_4",name:"足球鞋",pid:"l5"},
{id:"l5_5",name:"网羽鞋",pid:"l5"},
{id:"l5_6",name:"训鞋帆",pid:"l5"},
{id:"l5_7",name:"夹克卫衣",pid:"l5"},
{id:"l5_8",name:"冲锋衣",pid:"l5"},
{id:"l5_9",name:"抓绒衣",pid:"l5"},
{id:"l5_10",name:"速干衣",pid:"l5"},
{id:"l5_11",name:"冲锋裤",pid:"l5"},
{id:"l5_12",name:"登山鞋",pid:"l5"},
{id:"l5_13",name:"徒步鞋",pid:"l5"},

/*{id:"l6",name:"女鞋",pid:"12"},
{id:"l6_1",name:"单鞋",pid:"l6"},
{id:"l6_2",name:"休闲鞋",pid:"l6"},
{id:"l6_3",name:"帆布鞋",pid:"l6"},
{id:"l6_4",name:"单靴",pid:"l6"},
{id:"l6_5",name:"凉鞋",pid:"l6"},

{id:"l7",name:"童装",pid:"12"},
{id:"l7_1",name:"童鞋",pid:"l7"},
{id:"l7_2",name:"T恤/吊带衫",pid:"l7"},
{id:"l7_3",name:"内衣裤",pid:"l7"},
{id:"l7_4",name:"连身衣/爬服",pid:"l7"},
{id:"l7_5",name:"运动套装",pid:"l7"},
{id:"l7_6",name:"外套/夹克/大衣",pid:"l7"},
{id:"l7_7",name:"休闲裤",pid:"l7"},
{id:"l7_8",name:"马甲/背心",pid:"l7"},
{id:"l7_9",name:"毛衣",pid:"l7"},
{id:"l7_10",name:"衬衫",pid:"l7"},*/

{id:"l8",name:"女包",pid:"13"},
{id:"l8_1",name:"手拿包",pid:"l8"},
{id:"l8_2",name:"单肩包",pid:"l8"},
{id:"l8_3",name:"钱包",pid:"l8"},
{id:"l8_4",name:"斜挎包",pid:"l8"},
{id:"l8_5",name:"卡包/卡套",pid:"l8"},
{id:"l8_6",name:"手提包",pid:"l8"},
{id:"l8_7",name:"钥匙包",pid:"l8"},
{id:"l8_8",name:"双肩包",pid:"l8"},
{id:"l8_9",name:"休闲包",pid:"l8"},

{id:"l9",name:"男包",pid:"13"},
{id:"l9_1",name:"钱包",pid:"l9"},
{id:"l9_2",name:"单肩包",pid:"l9"},
{id:"l9_3",name:"双肩包",pid:"l9"},
{id:"l9_4",name:"钥匙包",pid:"l9"},
{id:"l9_5",name:"卡包/卡套",pid:"l9"},
{id:"l9_6",name:"手提包",pid:"l9"},
{id:"l9_7",name:"商务包",pid:"l9"},
{id:"l9_8",name:"公文包",pid:"l9"},
{id:"l9_9",name:"手拿包",pid:"l9"},
{id:"l9_10",name:"腰包",pid:"l9"},
{id:"l9_11",name:"休闲包",pid:"l9"},

{id:"l10",name:"功能箱包",pid:"13"},
{id:"l10_1",name:"拉杆箱",pid:"l10"},
{id:"l10_2",name:"电脑包",pid:"l10"},
{id:"l10_3",name:"洗漱包",pid:"l10"},
{id:"l10_4",name:"旅行包",pid:"l10"},
{id:"l10_5",name:"背包",pid:"l10"},
{id:"l10_6",name:"运动包",pid:"l10"},
{id:"l10_7",name:"相机包",pid:"l10"},
{id:"l10_8",name:"登机箱",pid:"l10"},
{id:"l10_9",name:"零钱包",pid:"l10"}]
$(function(){
		//初始化
		$(".level_1").empty();
		$(".level_2").empty();
		$(".level_3").empty();
		$(".level_4").empty();
        for(var x in levelData){
            levelData[x].selected=false;
            levelData[x].show=false;
        }
		for(var i = 0;i<9;i++){
			var _li = $("<li>"+levelData[i].name+"</li>");
			$(".level_1").append(_li);
		}
		for(var i = 9;i<16;i++){
			var _li = "<li date="+levelData[i].id+"><span></span>"+levelData[i].name+"</li>";
			$(".level_2").append($(_li));
		}
		//input_help_search
        $(".search_button").click(function(){
            var txt = $('.input_help_search').val();
            var isHad=false
            for(var x in levelData){
                if(levelData[x].name.indexOf(txt)>=0){
                    $(".level_1").empty();
                    isHad=true;
                    var _li = $("<li>"+levelData[x].name+"</li>");
                    $(".level_1").append(_li);

                }
            }
            if(!isHad){
                $(".mask").css({ display: "block", height: $(document).height() });
                $('#dialog_banner').show();
            }
        });
        $(".d_btn_close,.fa_close").click(function(){
            $(".mask").css({ display: "none", height: $(document).height() });
            $('#dialog_banner,#dialog_banner2,#dialog_banner3').hide();
        });
        //选择品牌
        var brandFlag=false;
        var liIndex;
        var sid="";
		if($(".level_1").length==0){
			brandFlag=true;
		}
        $(".level_1 li").live("click",function(){
            liClass($(this));
            if($(this).hasClass('on')){
                brandFlag=true;
            }

            //$("#brand_name").html("“"+$(this).text()+"”")
			$("#brand_name").html($(this).text())
        })
        //一级类目
        $(".level_2 li").click(function(){
            if(!brandFlag){
                $(".mask").css({ display: "block", height: $(document).height() });
                $('#dialog_banner2').show();
                return;
            }
            liClass($(this));
            var id = $(this).attr('date');
            $('.level_3').empty();
            $('.level_4').empty();
            listChild(id,$('.level_3'));
            if(id!=sid){
                liIndex=""
            }else{

                $('.level_3 li').eq(parseInt(liIndex)).click()
            }

         });

        $(".level_3 li").live('click',function(){

            liClass($(this));
            var id = $(this).attr('date');
            for(var x in levelData){
                if(levelData[x].id==id){
                    sid=levelData[x].pid;
                    liIndex=$(this).index();
                }
            }
            $('.level_4').empty();
            listChild(id,$('.level_4'));

         });
    /*$(".level_4 li").live('click',function(){

        liClass($(this));
        var id = $(this).attr('date');
        for(var x in levelData){
            if(levelData[x].id==id){
                sid=levelData[x].pid;
                liIndex=$(this).index();
            }
        }
        $('.level_4').empty();
        listChild(id,$('.level_4'));

    });*/
        $(".level_2 li span").live('click',function(){
            if(!brandFlag){
                $(".mask").css({ display: "block", height: $(document).height() });
                $('#dialog_banner2').show();
                return;
            }
            var _this=$(this);
            var id = _this.parent().attr('date');
            if(_this.hasClass('on')){
                onlyRemoveClass(_this);
                cancelSelect(id);
                $('.level_3').empty();
                $('.level_4').empty();
                listChild(id,$('.level_3'));
                displaySelected(id);
                showSelected();
            }else{
                onlyAddClass(_this);
                doSelect(id);
                $('.level_3').empty();
                $('.level_4').empty();
                listChild(id,$('.level_3'));
                displaySelected(id);
                showSelected();
            }
            if(id!=sid){
                liIndex=""
            }else{

                $('.level_3 li').eq(parseInt(liIndex)).click()
            }

        });
        $(".level_3 li span").live('click',function(){
            var _this=$(this);
            var id = _this.parent().attr('date');
            if(_this.hasClass('on')){
                onlyRemoveClass(_this);
                cancelSelect(id);
                $('.level_4').empty();
                listChild(id,$('.level_4'));
                refresh();
                displaySelected2(id);
                showSelected();
            }else{
                onlyAddClass(_this);
                doSelect(id);
                $('.level_4').empty();
                listChild(id,$('.level_4'));
                refresh();
                displaySelected2(id);
                showSelected();
            }

        });

        $(".level_4 li span").live('click',function(){
            var _this=$(this);
            var id = _this.parent().attr('date');
            if(_this.hasClass('on')){
                onlyRemoveClass(_this);
                cancelSelect(id);
                refresh();
                displaySelected3(id);
                showSelected();
            }else{
                onlyAddClass(_this);
                doSelect(id);
                refresh();
                displaySelected3(id);
                showSelected();
            }

        });


})

function liClass(obj){
    obj.parent().find('li.on').removeClass('on');
    obj.addClass('on');
}
function onlyAddClass(obj){
    obj.addClass('on');
}
function onlyRemoveClass(obj){
    obj.removeClass('on');
}
//查找子数据
function eachDate(id){
    var eachArr = new Array();
    for(var x in levelData){
        if(levelData[x].pid == id){
            eachArr.push(levelData[x]);
        }
    }
    return eachArr;
}
//展示数据
function listChild(id,contain){
    var eachArr = eachDate(id);
    for(var x in eachArr){
        var clazz = eachArr[x].selected==true?'on':'';
        _li = "<li date="+eachArr[x].id+"><span class='"+clazz+"'></span>"+eachArr[x].name+"</li>"
        contain.append($(_li))
    }
}
function doSelect(id){
    for(var x in levelData){
        if(levelData[x].id==id){
            levelData[x].selected=true;
            parentSelect(levelData[x].pid)
        }
        if(levelData[x].pid==id){
            levelData[x].selected=true;
            var p_id = levelData[x].id;
            for(var y in levelData){
                if(levelData[y].pid==p_id){
                    levelData[y].selected=true;
                }
            }
        }
    }
}
//递归
function parentSelect(id){
     if(id!=""){
         for(var x in levelData){
             if(levelData[x].id==id){
                levelData[x].selected=true;
                 if(levelData[x].pid!=""){
                     parentSelect(levelData[x].pid);
                 }

             }

         }
     }
}
//递归
function parentCancel(id){
    if(id!=""){
        for(var x in levelData){
            if(levelData[x].id==id){

                var hasSelected=0;
                var len = 0;
                for(var y in levelData){
                    if(levelData[x].id==levelData[y].pid){
                        len++;
                        if(!levelData[y].selected){
                            hasSelected++;
                            levelData[y].show=false;
                            for(var z in levelData){
                                if(levelData[z].pid==levelData[y].id){
                                    levelData[z].selected=false;
                                    levelData[z].show=false
                                }
                            }
                        }
                    }
                }
                if(hasSelected==len){
                    levelData[x].selected=false;
                    if(levelData[x].pid!=""){
                        parentCancel(levelData[x].pid);
                    }
                }else{
                    for(var y in levelData){
                        if(levelData[x].id==levelData[y].pid){
                            if(!levelData[y].selected){
                                levelData[y].show=false;
                            }
                        }
                    }
                }
            }
        }
    }
}
//刷新
function refresh(){
    $(".level_2 li,.level_3 li,.level_4 li").each(function(){
        for(var x in levelData){
            if(levelData[x].id==$(this).attr('date')&&levelData[x].selected){
                var span = $(this).find('span');
                onlyAddClass(span);
            }else if(levelData[x].id==$(this).attr('date')&&(!levelData[x].selected)){
                var span = $(this).find('span');
                onlyRemoveClass(span);
            }
        }
    })
}
//取消选择
function cancelSelect(id){
    if(id!=''){
        for(var x in levelData){
            if(levelData[x].id==id){
                levelData[x].selected=false;
                if(levelData[x].pid!=""){
                    parentCancel(levelData[x].pid);
                }else{
                    var pid=levelData[x].id;
                    for(var y in levelData){
                        if(levelData[y].pid == pid){
                            levelData[y].show=false;
                            for(var z in levelData ){
                                if(levelData[z].pid==levelData[y].id){
                                    levelData[z].show=false;
                                }
                            }
                        }
                    }

                }
            }
            if(levelData[x].pid==id){
                levelData[x].selected=false;
                var p_id = levelData[x].id;
                for(var y in levelData){
                    if(levelData[y].pid==p_id){
                        levelData[y].selected=false;
                    }
                }
            }
        }
    }

}

function showSelected(){
    $(".type_select").empty();
    for(var x in levelData){
        if(levelData[x].show){
            console.log(levelData[x].name)
            var _li = $('<li sel="'+ levelData[x].id+'">'+ levelData[x].name+'<a href="javascript:;" class="close">&nbsp;</a></li>');
            $(".type_select").append(_li);
        }
    }
    if($(".type_select li").length==0){
        $(".btn_i").addClass('dis_btn_i')
    }else{
        $(".btn_i").removeClass('dis_btn_i')
    }

}
function displaySelected(id){
    if(id!=""){
        publicEachShow(id);
    }
}
function displaySelected2(id){
    if(id!=""){
        var p_pid;
        for(var x in levelData){
            //获取他自己
            if(levelData[x].id==id){
                var p_pid = levelData[x].pid

            }
        }
        publicEachShow(p_pid)
    }

}






//三级
function displaySelected3(id){
    //爷爷的ID;
    var p_pid;
    for(var x in levelData){
        //获取他自己
        if(levelData[x].id==id){
            //获取他爹
            for(var y in levelData){
                if(levelData[y].id==levelData[x].pid){
                    p_pid=levelData[y].pid;

                }
            }
        }
    }
    publicEachShow(p_pid)


}
//三级
function hideSelected3(id){
    //爷爷的ID;
    var p_pid;
    for(var x in levelData){
        //获取他自己
        if(levelData[x].id==id){
            //获取他爹
            for(var y in levelData){
                if(levelData[y].id==levelData[x].pid){
                    p_pid=levelData[y].pid;

                }
            }
        }
    }
    publicEachShow(p_pid)


}



function publicEachShow(id){
    var p_pid = id;
    for(var x in levelData){
        if(levelData[x].id==p_pid){
            var len= 0,hasSelected=0;
            for(var y in levelData){
                if(levelData[y].pid==p_pid){
                    len++;
                    var len2=0,hasSelected2=0;
                    for(var z in levelData){
                        if(levelData[z].pid==levelData[y].id){
                            len2++;
                            if(levelData[z].selected){
                                hasSelected2++;
                            }
                        }
                    }
                    if(len2==hasSelected2){
                        hasSelected++;
                    }
                }
            }
            //二级全选中的情况下
            if(len==hasSelected){
                levelData[x].show=true;
                for(var y in levelData){
                    if(levelData[y].pid==p_pid){
                        levelData[y].show=false;
                        for(var z in levelData){
                            if(levelData[z].pid==levelData[y].id){
                                if(levelData[z].selected){
                                    levelData[z].show=false;
                                }
                            }
                        }
                    }
                }
                //二级没有全选中的情况下
            }else{
                levelData[x].show=false;
                for(var y in levelData){
                    if(levelData[y].pid==p_pid){
                        var len2= 0,hasSelected2=0;
                        for(var z in levelData){
                            if(levelData[z].pid==levelData[y].id){
                                len2++;
                                if(levelData[z].selected){
                                    hasSelected2++;
                                }
                            }
                        }
                        if(len2==hasSelected2){
                            levelData[y].show=true;
                            for(var z in levelData){
                                if(levelData[z].pid==levelData[y].id){
                                    if(levelData[z].selected){
                                        levelData[z].show=false
                                    }
                                }
                            }

                        }else{
                            levelData[y].show=false;
                            for(var z in levelData){
                                if(levelData[z].pid==levelData[y].id){
                                    if(levelData[z].selected){
                                        levelData[z].show=true;
                                    }
                                }
                            }

                        }
                    }
                }

            }
        }
    }

}

//删除已选
$(".type_select a").live('click',function(){
    var del_id = $(this).parent().attr('sel');
    publicEachShow(del_id);
    cancelSelect(del_id);
    showSelected();
    refresh();


})

//下一步
$(".btn_i").click(function(){
    if($(".type_select li").length==0){
        $(".mask").css({ display: "block", height: $(document).height() });
        $('#dialog_banner3').show();
    }else{
        var url = $(this).attr('thref');
        location.href=url;
    }
})
